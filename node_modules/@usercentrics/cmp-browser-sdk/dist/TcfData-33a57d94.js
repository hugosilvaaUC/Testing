import{y as e,m as t,B as s,n as i,t as n,o,f as r,g as c,u as a,_ as d,a as l,S as u,C as h,T as p,I as v,h as g,i as f,G as I,j as m,k as S,l as C,A as T}from"./index-7246577f.js";import{p as M,q as L,s as V,t as b,u as y,r as A,v as E,g as D,a as F,b as w,c as G,d as R,e as O,f as P,l as _,i as k,h as U,j as N,k as B,m as j,n as H,o as x}from"./index-322d91f3.js";import W from"./DefaultData-5ed5bb39.js";var K=function(W){function K(e,r,c){var a=W.call(this,e,c)||this;a.locationInstance=t.getInstance(),a.botInstance=s.getInstance(),a.previousStorage=null,a.selectedVendorsIncludeNonDisclosed=!1,a.cmpApi={},a.tcModel=null,a.tcfData=null,a.vendors=[];var d=e.tcf2,l=d.changedPurposes,u=d.cmpId,h=d.cmpVersion,p=d.consensuScriptPath,v=d.disabledSpecialFeatures,g=d.gdprApplies,f=d.hideLegitimateInterestToggles,I=d.publisherCountryCode,m=d.purposeOneTreatment,S=d.scope,C=d.selectedStacks,T=d.selectedVendorIds,D=d.tcfv2HistoryDisabled;return a.changedPurposes=M(l),a.cmpId=u||5,a.cmpVersion=h||i(),a.consensuScriptPath=L(p),a.consensuSubdomain=V(e.tcf2.consensuDomain),a.disabledSpecialFeatures=v||[],a.gdprApplies=n(g,!1),a.hideLegitimateInterestToggles=f,a.isServiceSpecific=S===o.SERVICE,a.publisherCountryCode=I||"DE",a.purposeOneTreatment=n(m,!1),a.resurfaceOptions=b(e.tcf2),a.stackIds=C||[],a.tcfv2HistoryDisabled=D,a.useGranularChoice=y(e.tcf2.firstLayerHideToggles,e.tcf2.secondLayerHideToggles),a.vendorIds=T||[],a.selectedLanguage=A(e.language),a.cmpApi=new E.CmpApi(a.cmpId,a.cmpVersion,a.isServiceSpecific),a.dataTransferSettings=r,a}return e(K,W),K.prototype.updateControllerId=function(e){this.dataTransferSettings.controllerId=e},K.prototype.acceptAllDisclosed=function(e){var t,s;return r(this,void 0,void 0,(function(){var i,n,o;return c(this,(function(r){switch(r.label){case 0:return(i=this.tcModel)?(n=[],o=[],this.getVendors().forEach((function(e){var t=e.id,s=e.legitimateInterestPurposes,r=e.purposes,c=e.specialPurposes;r.length?(i.vendorConsents.set(t),n=n.concat(r.map((function(e){return e.id})))):i.vendorConsents.unset(t),s.length||c.length?(i.vendorLegitimateInterests.set(t),o=o.concat(s.map((function(e){return e.id})))):i.vendorLegitimateInterests.unset(t)})),i.purposeConsents.set(a(n)),i.purposeLegitimateInterests.set(a(o)),this.hideLegitimateInterestToggles&&(i.unsetAllVendorLegitimateInterests(),i.unsetAllPurposeLegitimateInterests()),i.specialFeatureOptins.set(D(null===(s=null===(t=this.tcModel)||void 0===t?void 0:t.gvl)||void 0===s?void 0:s.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),this.tcModel=i,[4,this.updateTCString(e)]):[2];case 1:return r.sent(),[2]}}))}))},K.prototype.areAllPurposesAccepted=function(){var e,t;return F(this.tcModel,null===(e=this.tcModel)||void 0===e?void 0:e.gvl.stacks,null===(t=this.tcModel)||void 0===t?void 0:t.gvl.purposes,this.vendors,this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles).every((function(e){var t=!0,s=!0;return e.showConsentToggle&&null!==e.consent&&(t=e.consent),e.showLegitimateInterestToggle&&null!==e.legitimateInterestConsent&&(s=e.legitimateInterestConsent),t&&s}))},K.prototype.areAllVendorsAccepted=function(){if(!this.tcModel)return!0;var e=d([],l(this.tcModel.gvl.vendorIds)),t=this.getVendors();return e.every((function(e){var s=t.find((function(t){return t.id===e})),i=!0,n=!0;return!!s&&(s.showConsentToggle&&null!==s.consent&&(i=s.consent),s.showLegitimateInterestConsentToggle&&null!==s.legitimateInterestConsent&&(n=s.legitimateInterestConsent),i&&n)}))},K.prototype.changeLanguage=function(e){return r(this,void 0,void 0,(function(){var t;return c(this,(function(s){switch(s.label){case 0:return t=A(e),[4,this.resetGVLWithLanguage("en"===t?t+"-v2":t)];case 1:return s.sent(),this.tcModel&&this.tcModel.gvl.narrowVendorsTo(this.vendorIds),this.resetTcfData(),[2]}}))}))},K.prototype.denyAllDisclosed=function(e){return r(this,void 0,void 0,(function(){var t;return c(this,(function(s){switch(s.label){case 0:return this.tcModel?(this.tcModel.unsetAllVendorConsents(),this.tcModel.unsetAllVendorLegitimateInterests(),t=w(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment),this.tcModel.purposeConsents.unset(t),this.tcModel.purposeLegitimateInterests.unset(t),this.tcModel.specialFeatureOptins.unset(D(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),[4,this.updateTCString(e)]):[2];case 1:return s.sent(),[2]}}))}))},K.prototype.getSelectedVendorsIncludeNonDisclosed=function(){return this.selectedVendorsIncludeNonDisclosed},K.prototype.getTCFData=function(){var e,t,s,i,n,o,r,c,a;return this.tcfData||(this.tcfData={features:G(this.getVendors(),null===(t=null===(e=this.tcModel)||void 0===e?void 0:e.gvl)||void 0===t?void 0:t.features),purposes:F(this.tcModel,null===(s=this.tcModel)||void 0===s?void 0:s.gvl.stacks,null===(i=this.tcModel)||void 0===i?void 0:i.gvl.purposes,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles),specialFeatures:R(this.tcModel,null===(n=this.tcModel)||void 0===n?void 0:n.gvl,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.useGranularChoice),specialPurposes:O(null===(r=null===(o=this.tcModel)||void 0===o?void 0:o.gvl)||void 0===r?void 0:r.specialPurposes,this.getVendors()),stacks:P(null===(a=null===(c=this.tcModel)||void 0===c?void 0:c.gvl)||void 0===a?void 0:a.stacks,this.disabledSpecialFeatures,this.stackIds),vendors:this.getVendors()}),this.tcfData},K.prototype.getGdprApplies=function(){return r(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.gdprApplies?[4,this.locationInstance.getIsUserInEU()]:[2,!0];case 1:return[2,e.sent()]}}))}))},K.prototype.getTCString=function(){return this.tcModel?_.TCString.encode(this.tcModel):""},K.prototype.init=function(){return r(this,void 0,void 0,(function(){var e,t=this;return c(this,(function(s){switch(s.label){case 0:return this.previousStorage=u.fetchTCFData(),e="",this.isServiceSpecific?[3,3]:[4,h.init(v.COOKIE_BRIDGE,{cookieBridgeScriptPath:this.consensuScriptPath,cookieBridgeSubdomain:this.consensuSubdomain,useEuCdn:!1}).then((function(){h.setIsCookieBridgeAvailable(!0)})).catch((function(){console.warn(p.COOKIE_BRIDGE_NOT_AVAILABLE),h.removeIFrame(g)}))];case 1:return s.sent(),[4,h.getGlobalTCString().catch((function(){return console.warn(p.GET_GLOBAL_TC_STRING_FAILURE),t.isServiceSpecific=!0,""}))];case 2:e=s.sent(),s.label=3;case 3:return e||(e=u.fetchTCString()||""),[4,this.initTCModel(e,!1)];case 4:return s.sent(),this.botInstance.isRobot()&&this.acceptAllDisclosed(1),[2]}}))}))},K.prototype.setUIAsClosed=function(){return r(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.cmpApiUpdate(u.fetchTCString(),!1)]}))}))},K.prototype.setUIAsOpen=function(){return r(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.cmpApiUpdate(u.fetchTCString(),!0)]}))}))},K.prototype.shouldResurfaceUI=function(){var e=this.resurfaceOptions;return e.onIABLegalBasisChanged&&k(this.previousStorage,this.tcModel)||e.onVendorAdded&&U(this.previousStorage,this.getVendors())||e.onPurposeChanged&&N(this.previousStorage,this.getVendors())||e.onPeriodEnded&&B(this.previousStorage)},K.prototype.updateChoices=function(e,t){return r(this,void 0,void 0,(function(){return c(this,(function(s){switch(s.label){case 0:return e.purposes?[4,this.savePurposes(e.purposes)]:[3,2];case 1:s.sent(),s.label=2;case 2:return e.specialFeatures?[4,this.saveSpecialFeatures(e.specialFeatures)]:[3,4];case 3:s.sent(),s.label=4;case 4:return e.vendors?[4,this.saveVendors(e.vendors)]:[3,6];case 5:s.sent(),s.label=6;case 6:return this.tcModel&&this.hideLegitimateInterestToggles&&(this.tcModel.unsetAllVendorLegitimateInterests(),this.tcModel.unsetAllPurposeLegitimateInterests()),e.purposes||e.specialFeatures||e.vendors?[4,this.updateTCString(t)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[2]}}))}))},K.prototype.resetTcf=function(){this.cmpApi={},this.selectedVendorsIncludeNonDisclosed=!1,this.tcModel={},this.tcfData=null,this.vendors=[],h.removeIFrame(g)},K.prototype.applyPurposeRestrictions=function(e,t){var s=this;e.forEach((function(e){var i,n=new _.PurposeRestriction(e,t);null===(i=s.tcModel)||void 0===i||i.publisherRestrictions.restrictPurposeToLegalBasis(n)}))},K.prototype.cmpApiUpdate=function(e,t){return r(this,void 0,void 0,(function(){return c(this,(function(s){switch(s.label){case 0:return[4,this.getGdprApplies()];case 1:return s.sent()?this.cmpApi.update(e,t):this.cmpApi.update(null),[2]}}))}))},K.prototype.getVendors=function(){return f(this.vendors)||this.setVendors(),this.vendors},K.prototype.initTCModel=function(e,t){return r(this,void 0,void 0,(function(){var s,i,n,o,r,a,u;return c(this,(function(c){switch(c.label){case 0:if(_.GVL.baseUrl=t?I:m,_.GVL.languageFilename=S,_.GVL.latestFilename=C,s=new _.GVL,this.tcModel=new _.TCModel(s),this.tcModel.cmpId=this.cmpId,this.tcModel.cmpVersion=this.cmpVersion,this.tcModel.isServiceSpecific=this.isServiceSpecific,this.tcModel.publisherCountryCode=this.publisherCountryCode,this.tcModel.purposeOneTreatment=this.purposeOneTreatment,e)try{i=this.tcModel.gvl,this.tcModel=_.TCString.decode(e,this.tcModel),this.tcModel.gvl=i}catch(h){console.warn(p.INIT_TCF_ERROR,h.message)}if(null===this.tcModel)throw new Error(p.TC_MODEL_UNDEFINED);if(!this.selectedLanguage)throw new Error(p.SELECTED_LANGUAGE_UNDEFINED);return[4,this.tcModel.gvl.readyPromise.catch((function(e){console.warn(p.RESET_GVL_FAILURE,e)}))];case 1:return c.sent(),this.tcModel.gvl.narrowVendorsTo(this.vendorIds),n=d([],l(this.tcModel.gvl.vendorIds)),o=A(this.selectedLanguage),[4,this.resetGVLWithLanguage("en"===o?o+"-v2":o)];case 2:return c.sent(),this.isServiceSpecific&&(r=this.changedPurposes,a=r.purposes,u=r.legitimateInterestPurposes,this.applyPurposeRestrictions(a,_.RestrictionType.REQUIRE_CONSENT),this.applyPurposeRestrictions(u,_.RestrictionType.REQUIRE_LI)),this.setSelectedVendorsIncludeNonDisclosed(n),!this.isServiceSpecific&&this.tcModel&&this.tcModel.vendorsDisclosed.set(n),[2]}}))}))},K.prototype.resetGVLWithLanguage=function(e){var t,s;return r(this,void 0,void 0,(function(){var i;return c(this,(function(n){return i=A(e),[2,null===(s=null===(t=this.tcModel)||void 0===t?void 0:t.gvl)||void 0===s?void 0:s.changeLanguage(i).catch((function(e){console.warn(p.RESET_GVL_FAILURE,e)}))]}))}))},K.prototype.resetTcfData=function(){this.vendors=[],this.tcfData=null},K.prototype.setSelectedVendorsIncludeNonDisclosed=function(e){var t=this,s=u.fetchTCFVendorsDisclosedObject();e.some((function(e){var i;return t.isServiceSpecific?!j(e,s):!(null===(i=t.tcModel)||void 0===i?void 0:i.vendorsDisclosed.has(e))}))&&(this.selectedVendorsIncludeNonDisclosed=!0)},K.prototype.savePurposes=function(e){return r(this,void 0,void 0,(function(){var t;return c(this,(function(s){return(t=this.tcModel)?(e.forEach((function(e){e.consent?t.purposeConsents.set(e.id):t.purposeConsents.unset(e.id),e.legitimateInterestConsent?t.purposeLegitimateInterests.set(e.id):t.purposeLegitimateInterests.unset(e.id)})),[2]):[2]}))}))},K.prototype.saveSpecialFeatures=function(e){return r(this,void 0,void 0,(function(){var t;return c(this,(function(s){return(t=this.tcModel)?(e.forEach((function(e){e.consent?t.specialFeatureOptins.set(e.id):t.specialFeatureOptins.unset(e.id)})),[2]):[2]}))}))},K.prototype.saveVendors=function(e){return r(this,void 0,void 0,(function(){var t;return c(this,(function(s){return(t=this.tcModel)?(e.forEach((function(e){e.consent?t.vendorConsents.set(e.id):t.vendorConsents.unset(e.id),e.legitimateInterestConsent?t.vendorLegitimateInterests.set(e.id):t.vendorLegitimateInterests.unset(e.id)})),[2]):[2]}))}))},K.prototype.setVendors=function(){this.vendors=H(this.tcModel,this.disabledSpecialFeatures,this.useGranularChoice,this.hideLegitimateInterestToggles,this.purposeOneTreatment)},K.prototype.updateTCString=function(e){return r(this,void 0,void 0,(function(){var t,s;return c(this,(function(i){switch(i.label){case 0:return this.tcModel&&(this.tcModel.consentScreen=e,this.tcModel.updated()),t=this.getTCString(),this.isServiceSpecific?[3,2]:[4,h.setGlobalTCString(t).catch((function(){console.warn(p.SET_GLOBAL_TC_STRING_FAILURE)}))];case 1:i.sent(),i.label=2;case 2:return s={tcString:t,timestamp:Date.now(),vendors:x(this.getVendors())},u.saveTCFData(s),[4,this.cmpApiUpdate(t,!1)];case 3:return i.sent(),this.resetTcfData(),this.botInstance.isRobot()?[3,5]:[4,T.getInstance().saveTCFConsents(this.dataTransferSettings,s,"onTcfStringChange","implicit")];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},K}(W);export default K;
//# sourceMappingURL=TcfData-33a57d94.js.map
