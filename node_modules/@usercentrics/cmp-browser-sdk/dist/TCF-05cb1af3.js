import{f as e,g as t,u as s,_ as i,a as n,S as o,C as r,T as c,I as a,h as d,i as l,G as u,j as h,k as p,l as v,A as g,m as f,B as I,n as m,o as S}from"./index-7246577f.js";import{g as C,a as T,r as M,b as L,c as V,d as b,e as y,f as A,l as D,i as E,h as F,j as w,k as G,m as R,n as O,o as P,p as _,q as k,s as U,t as N,u as B,v as j}from"./index-322d91f3.js";var H=function(){function H(e,t){this.locationInstance=f.getInstance(),this.botInstance=I.getInstance(),this.previousStorage=null,this.selectedVendorsIncludeNonDisclosed=!1,this.cmpApi={},this.tcModel=null,this.tcfData=null,this.vendors=[];var s=e.tcf2,i=s.changedPurposes,n=s.cmpId,o=s.cmpVersion,r=s.consensuScriptPath,c=s.disabledSpecialFeatures,a=s.gdprApplies,d=s.hideLegitimateInterestToggles,l=s.publisherCountryCode,u=s.purposeOneTreatment,h=s.scope,p=s.selectedStacks,v=s.selectedVendorIds,g=s.tcfv2HistoryDisabled;this.changedPurposes=_(i),this.cmpId=n||5,this.cmpVersion=o||m(),this.consensuScriptPath=k(r),this.consensuSubdomain=U(e.tcf2.consensuDomain),this.disabledSpecialFeatures=c||[],this.gdprApplies=a||!1,this.hideLegitimateInterestToggles=d,this.isServiceSpecific=h===S.SERVICE,this.publisherCountryCode=l||"DE",this.purposeOneTreatment=u||!1,this.resurfaceOptions=N(e.tcf2),this.stackIds=p||[],this.tcfv2HistoryDisabled=g,this.useGranularChoice=B(e.tcf2.firstLayerHideToggles,e.tcf2.secondLayerHideToggles),this.vendorIds=v||[],this.selectedLanguage=M(e.language),this.cmpApi=new j.CmpApi(this.cmpId,this.cmpVersion,this.isServiceSpecific),this.dataTransferSettings=t}return H.prototype.updateControllerId=function(e){this.dataTransferSettings.controllerId=e},H.prototype.acceptAllDisclosed=function(i){var n,o;return e(this,void 0,void 0,(function(){var e,r,c;return t(this,(function(t){switch(t.label){case 0:return(e=this.tcModel)?(r=[],c=[],this.getVendors().forEach((function(t){var s=t.id,i=t.legitimateInterestPurposes,n=t.purposes,o=t.specialPurposes;n.length?(e.vendorConsents.set(s),r=r.concat(n.map((function(e){return e.id})))):e.vendorConsents.unset(s),i.length||o.length?(e.vendorLegitimateInterests.set(s),c=c.concat(i.map((function(e){return e.id})))):e.vendorLegitimateInterests.unset(s)})),e.purposeConsents.set(s(r)),e.purposeLegitimateInterests.set(s(c)),this.hideLegitimateInterestToggles&&(e.unsetAllVendorLegitimateInterests(),e.unsetAllPurposeLegitimateInterests()),e.specialFeatureOptins.set(C(null===(o=null===(n=this.tcModel)||void 0===n?void 0:n.gvl)||void 0===o?void 0:o.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),this.tcModel=e,[4,this.updateTCString(i)]):[2];case 1:return t.sent(),[2]}}))}))},H.prototype.areAllPurposesAccepted=function(){var e,t;return T(this.tcModel,null===(e=this.tcModel)||void 0===e?void 0:e.gvl.stacks,null===(t=this.tcModel)||void 0===t?void 0:t.gvl.purposes,this.vendors,this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles).every((function(e){var t=!0,s=!0;return e.showConsentToggle&&null!==e.consent&&(t=e.consent),e.showLegitimateInterestToggle&&null!==e.legitimateInterestConsent&&(s=e.legitimateInterestConsent),t&&s}))},H.prototype.areAllVendorsAccepted=function(){if(!this.tcModel)return!0;var e=i([],n(this.tcModel.gvl.vendorIds)),t=this.getVendors();return e.every((function(e){var s=t.find((function(t){return t.id===e})),i=!0,n=!0;return!!s&&(s.showConsentToggle&&null!==s.consent&&(i=s.consent),s.showLegitimateInterestConsentToggle&&null!==s.legitimateInterestConsent&&(n=s.legitimateInterestConsent),i&&n)}))},H.prototype.changeLanguage=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return e=M(s),[4,this.resetGVLWithLanguage("en"===e?e+"-v2":e)];case 1:return t.sent(),this.tcModel&&this.tcModel.gvl.narrowVendorsTo(this.vendorIds),this.resetTcfData(),[2]}}))}))},H.prototype.denyAllDisclosed=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return this.tcModel?(this.tcModel.unsetAllVendorConsents(),this.tcModel.unsetAllVendorLegitimateInterests(),e=L(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment),this.tcModel.purposeConsents.unset(e),this.tcModel.purposeLegitimateInterests.unset(e),this.tcModel.specialFeatureOptins.unset(C(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),[4,this.updateTCString(s)]):[2];case 1:return t.sent(),[2]}}))}))},H.prototype.getSelectedVendorsIncludeNonDisclosed=function(){return this.selectedVendorsIncludeNonDisclosed},H.prototype.getTCFData=function(){var e,t,s,i,n,o,r,c,a;return this.tcfData||(this.tcfData={features:V(this.getVendors(),null===(t=null===(e=this.tcModel)||void 0===e?void 0:e.gvl)||void 0===t?void 0:t.features),purposes:T(this.tcModel,null===(s=this.tcModel)||void 0===s?void 0:s.gvl.stacks,null===(i=this.tcModel)||void 0===i?void 0:i.gvl.purposes,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles),specialFeatures:b(this.tcModel,null===(n=this.tcModel)||void 0===n?void 0:n.gvl,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.useGranularChoice),specialPurposes:y(null===(r=null===(o=this.tcModel)||void 0===o?void 0:o.gvl)||void 0===r?void 0:r.specialPurposes,this.getVendors()),stacks:A(null===(a=null===(c=this.tcModel)||void 0===c?void 0:c.gvl)||void 0===a?void 0:a.stacks,this.disabledSpecialFeatures,this.stackIds),vendors:this.getVendors()}),this.tcfData},H.prototype.getGdprApplies=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return this.gdprApplies?[4,this.locationInstance.getIsUserInEU()]:[2,!0];case 1:return[2,e.sent()]}}))}))},H.prototype.getTCString=function(){return this.tcModel?D.TCString.encode(this.tcModel):""},H.prototype.init=function(){return e(this,void 0,void 0,(function(){var e,s=this;return t(this,(function(t){switch(t.label){case 0:return this.previousStorage=o.fetchTCFData(),e="",this.isServiceSpecific?[3,3]:[4,r.init(a.COOKIE_BRIDGE,{cookieBridgeScriptPath:this.consensuScriptPath,cookieBridgeSubdomain:this.consensuSubdomain,useEuCdn:!1}).then((function(){r.setIsCookieBridgeAvailable(!0)})).catch((function(){console.warn(c.COOKIE_BRIDGE_NOT_AVAILABLE),r.removeIFrame(d)}))];case 1:return t.sent(),[4,r.getGlobalTCString().catch((function(){return console.warn(c.GET_GLOBAL_TC_STRING_FAILURE),s.isServiceSpecific=!0,""}))];case 2:e=t.sent(),t.label=3;case 3:return e||(e=o.fetchTCString()||""),[4,this.initTCModel(e,!1)];case 4:return t.sent(),this.botInstance.isRobot()&&this.acceptAllDisclosed(1),[2]}}))}))},H.prototype.setUIAsClosed=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,this.cmpApiUpdate(o.fetchTCString(),!1)]}))}))},H.prototype.setUIAsOpen=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,this.cmpApiUpdate(o.fetchTCString(),!0)]}))}))},H.prototype.shouldResurfaceUI=function(){var e=this.resurfaceOptions;return e.onIABLegalBasisChanged&&E(this.previousStorage,this.tcModel)||e.onVendorAdded&&F(this.previousStorage,this.getVendors())||e.onPurposeChanged&&w(this.previousStorage,this.getVendors())||e.onPeriodEnded&&G(this.previousStorage)},H.prototype.updateChoices=function(s,i){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return s.purposes?[4,this.savePurposes(s.purposes)]:[3,2];case 1:e.sent(),e.label=2;case 2:return s.specialFeatures?[4,this.saveSpecialFeatures(s.specialFeatures)]:[3,4];case 3:e.sent(),e.label=4;case 4:return s.vendors?[4,this.saveVendors(s.vendors)]:[3,6];case 5:e.sent(),e.label=6;case 6:return this.tcModel&&this.hideLegitimateInterestToggles&&(this.tcModel.unsetAllVendorLegitimateInterests(),this.tcModel.unsetAllPurposeLegitimateInterests()),s.purposes||s.specialFeatures||s.vendors?[4,this.updateTCString(i)]:[3,8];case 7:e.sent(),e.label=8;case 8:return[2]}}))}))},H.prototype.resetTcf=function(){this.cmpApi={},this.selectedVendorsIncludeNonDisclosed=!1,this.tcModel={},this.tcfData=null,this.vendors=[],r.removeIFrame(d)},H.prototype.applyPurposeRestrictions=function(e,t){var s=this;e.forEach((function(e){var i,n=new D.PurposeRestriction(e,t);null===(i=s.tcModel)||void 0===i||i.publisherRestrictions.restrictPurposeToLegalBasis(n)}))},H.prototype.cmpApiUpdate=function(s,i){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,this.getGdprApplies()];case 1:return e.sent()?this.cmpApi.update(s,i):this.cmpApi.update(null),[2]}}))}))},H.prototype.getVendors=function(){return l(this.vendors)||this.setVendors(),this.vendors},H.prototype.initTCModel=function(s,o){return e(this,void 0,void 0,(function(){var e,r,a,d,l,g,f;return t(this,(function(t){switch(t.label){case 0:if(D.GVL.baseUrl=o?u:h,D.GVL.languageFilename=p,D.GVL.latestFilename=v,e=new D.GVL,this.tcModel=new D.TCModel(e),this.tcModel.cmpId=this.cmpId,this.tcModel.cmpVersion=this.cmpVersion,this.tcModel.isServiceSpecific=this.isServiceSpecific,this.tcModel.publisherCountryCode=this.publisherCountryCode,this.tcModel.purposeOneTreatment=this.purposeOneTreatment,s)try{r=this.tcModel.gvl,this.tcModel=D.TCString.decode(s,this.tcModel),this.tcModel.gvl=r}catch(I){console.warn(c.INIT_TCF_ERROR,I.message)}if(null===this.tcModel)throw new Error(c.TC_MODEL_UNDEFINED);if(!this.selectedLanguage)throw new Error(c.SELECTED_LANGUAGE_UNDEFINED);return[4,this.tcModel.gvl.readyPromise.catch((function(e){console.warn(c.RESET_GVL_FAILURE,e)}))];case 1:return t.sent(),this.tcModel.gvl.narrowVendorsTo(this.vendorIds),a=i([],n(this.tcModel.gvl.vendorIds)),d=M(this.selectedLanguage),[4,this.resetGVLWithLanguage("en"===d?d+"-v2":d)];case 2:return t.sent(),this.isServiceSpecific&&(l=this.changedPurposes,g=l.purposes,f=l.legitimateInterestPurposes,this.applyPurposeRestrictions(g,D.RestrictionType.REQUIRE_CONSENT),this.applyPurposeRestrictions(f,D.RestrictionType.REQUIRE_LI)),this.setSelectedVendorsIncludeNonDisclosed(a),!this.isServiceSpecific&&this.tcModel&&this.tcModel.vendorsDisclosed.set(a),[2]}}))}))},H.prototype.resetGVLWithLanguage=function(s){var i,n;return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return e=M(s),[2,null===(n=null===(i=this.tcModel)||void 0===i?void 0:i.gvl)||void 0===n?void 0:n.changeLanguage(e).catch((function(e){console.warn(c.RESET_GVL_FAILURE,e)}))]}))}))},H.prototype.resetTcfData=function(){this.vendors=[],this.tcfData=null},H.prototype.setSelectedVendorsIncludeNonDisclosed=function(e){var t,s,i=this,n=o.fetchTCFData(),r=n.tcString,c=n.timestamp,a=n.vendors,d=n.vendorsDisclosed;if(""===r||0!==a.length||d)s=o.fetchTCFVendorsDisclosedObject();else{var l={tcString:r,timestamp:c||Date.now(),vendors:[],vendorsDisclosed:e};o.saveTCFData(l),s=o.fetchTCFVendorsDisclosedObject(null===(t=this.tcModel)||void 0===t?void 0:t.gvl)}e.some((function(e){var t;return i.isServiceSpecific?!R(e,s):!(null===(t=i.tcModel)||void 0===t?void 0:t.vendorsDisclosed.has(e))}))&&(this.selectedVendorsIncludeNonDisclosed=!0)},H.prototype.savePurposes=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return(e=this.tcModel)?(s.forEach((function(t){t.consent?e.purposeConsents.set(t.id):e.purposeConsents.unset(t.id),t.legitimateInterestConsent?e.purposeLegitimateInterests.set(t.id):e.purposeLegitimateInterests.unset(t.id)})),[2]):[2]}))}))},H.prototype.saveSpecialFeatures=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return(e=this.tcModel)?(s.forEach((function(t){t.consent?e.specialFeatureOptins.set(t.id):e.specialFeatureOptins.unset(t.id)})),[2]):[2]}))}))},H.prototype.saveVendors=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return(e=this.tcModel)?(s.forEach((function(t){t.consent?e.vendorConsents.set(t.id):e.vendorConsents.unset(t.id),t.legitimateInterestConsent?e.vendorLegitimateInterests.set(t.id):e.vendorLegitimateInterests.unset(t.id)})),[2]):[2]}))}))},H.prototype.setVendors=function(){this.vendors=O(this.tcModel,this.disabledSpecialFeatures,this.useGranularChoice,this.hideLegitimateInterestToggles,this.purposeOneTreatment)},H.prototype.updateTCString=function(s){return e(this,void 0,void 0,(function(){var e,i;return t(this,(function(t){switch(t.label){case 0:return this.tcModel&&(this.tcModel.consentScreen=s,this.tcModel.updated()),e=this.getTCString(),this.isServiceSpecific?[3,2]:[4,r.setGlobalTCString(e).catch((function(){console.warn(c.SET_GLOBAL_TC_STRING_FAILURE)}))];case 1:t.sent(),t.label=2;case 2:return i={tcString:e,timestamp:Date.now(),vendors:P(this.getVendors())},o.saveTCFData(i),[4,this.cmpApiUpdate(e,!1)];case 3:return t.sent(),this.resetTcfData(),this.botInstance.isRobot()?[3,5]:[4,g.getInstance().saveTCFConsents(this.dataTransferSettings,i,"onTcfStringChange","implicit")];case 4:t.sent(),t.label=5;case 5:return[2]}}))}))},H}();export default H;
//# sourceMappingURL=TCF-05cb1af3.js.map
